{% extends 'base.html' %}
{% load static %}

{% block title %}لوحة المخزون{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/stock/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="stock-dashboard">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1>
                <i class="fas fa-box"></i>
                لوحة المخزون
            </h1>
            <p class="subtitle">نظرة شاملة على حالة المخزون</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'stock:products' %}" class="btn btn-outline">
                <i class="fas fa-list"></i>
                المنتجات
            </a>
            <a href="{% url 'stock:categories' %}" class="btn btn-outline">
                <i class="fas fa-folder"></i>
                التصنيفات
            </a>
            <a href="{% url 'stock:suppliers' %}" class="btn btn-outline">
                <i class="fas fa-building"></i>
                الموردين
            </a>
            <a href="{% url 'stock:laboratory' %}" class="btn btn-outline">
                <i class="fas fa-flask"></i>
                المعمل
            </a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card primary">
            <div class="stat-icon">
                <i class="fas fa-box"></i>
            </div>
            <div class="stat-info">
                <h3>{{ total_products }}</h3>
                <p>إجمالي المنتجات</p>
            </div>
        </div>

        <div class="stat-card warning">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-info">
                <h3>{{ low_stock_count }}</h3>
                <p>منتجات منخفضة</p>
            </div>
        </div>

        <div class="stat-card danger">
            <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-info">
                <h3>{{ out_of_stock }}</h3>
                <p>نفذ المخزون</p>
            </div>
        </div>

        <div class="stat-card success">
            <div class="stat-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-info">
                <h3>{{ total_value|floatformat:0 }}</h3>
                <p>قيمة المخزون (ريال)</p>
            </div>
        </div>
    </div>

    <!-- Low Stock Alert -->
    {% if low_stock_count > 0 %}
    <div class="alert alert-warning">
        <div class="alert-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="alert-content">
            <h3>تنبيه المخزون المنخفض</h3>
            <p>{{ low_stock_count }} منتج وصل للحد الأدنى من المخزون</p>
        </div>
        <a href="{% url 'stock:products' %}?status=low" class="alert-action">
            عرض الكل
            <i class="fas fa-arrow-left"></i>
        </a>
    </div>

    <!-- Low Stock Products -->
    <div class="section-card">
        <div class="section-header">
            <h2>
                <i class="fas fa-exclamation-circle"></i>
                منتجات تحتاج إعادة طلب
            </h2>
        </div>
        <div class="low-stock-list">
            {% for product in low_stock_products %}
            <div class="low-stock-item">
                <div class="product-info">
                    <h4>{{ product.item_name }}</h4>
                    <p class="barcode">{{ product.barcode }}</p>
                </div>
                <div class="product-quantity">
                    <span class="quantity danger">{{ product.quantity }} قطعة</span>
                    <span class="min-quantity">الحد الأدنى: {{ product.min_quantity }}</span>
                </div>
                <a href="{% url 'stock:product_detail' product.pk %}" class="btn-view">
                    <i class="fas fa-eye"></i>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Categories Stats -->
    <div class="section-card">
        <div class="section-header">
            <h2>
                <i class="fas fa-chart-bar"></i>
                إحصائيات التصنيفات
            </h2>
            <a href="{% url 'stock:categories' %}" class="btn-link">
                عرض الكل
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>
        <div class="categories-stats">
            {% for category in categories_stats %}
            <div class="category-stat-item">
                <div class="category-info">
                    <div class="category-icon" style="background-color: {{ category.color }};">
                        <i class="{{ category.icon }}"></i>
                    </div>
                    <div class="category-details">
                        <h4>{{ category.name }}</h4>
                        <p>{{ category.products_count }} منتج</p>
                    </div>
                </div>
                <div class="category-quantity">
                    <span class="quantity-badge">{{ category.total_quantity|default:0 }}</span>
                    <span class="quantity-label">قطعة</span>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <i class="fas fa-folder-open"></i>
                <p>لا توجد تصنيفات</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Movements -->
    <div class="section-card">
        <div class="section-header">
            <h2>
                <i class="fas fa-exchange-alt"></i>
                آخر حركات المخزون
            </h2>
        </div>
        <div class="movements-list">
            {% for movement in recent_movements %}
            <div class="movement-item">
                <div class="movement-icon {{ movement.movement_type_color }}">
                    <i class="fas {{ movement.movement_type_icon }}"></i>
                </div>
                <div class="movement-info">
                    <h4>{{ movement.product.item_name }}</h4>
                    <p class="movement-type">{{ movement.get_movement_type_display }}</p>
                </div>
                <div class="movement-quantity">
                    <span class="quantity {{ movement.movement_type_color }}">
                        {% if movement.movement_type == 'in' or movement.movement_type == 'return' %}+{% else %}-{% endif %}{{ movement.quantity }}
                    </span>
                </div>
                <div class="movement-date">
                    <span>{{ movement.created_at|date:"Y-m-d" }}</span>
                    <span class="time">{{ movement.created_at|date:"H:i" }}</span>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>لا توجد حركات حتى الآن</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/stock/dashboard.js' %}"></script>
{% endblock %}