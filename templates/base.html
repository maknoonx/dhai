{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ company_name }} - نظام الإدارة{% endblock %}</title>
    
    <!-- Google Fonts - Cairo for Arabic -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Base CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    
    <!-- Page Specific CSS -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <!-- Logo Section -->
        <div class="sidebar-logo">
            <div class="logo-container">
                {% if company_logo %}
                <img src="{{ company_logo }}" alt="{{ company_name }}" class="logo-image">
                {% else %}
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                {% endif %}
                <span class="logo-text">{{ company_name }}</span>
            </div>
        </div>

        <!-- Toggle Button -->
        <button id="sidebar-toggle" class="sidebar-toggle">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <a href="{% url 'dashboard' %}" class="nav-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="nav-text">لوحة التحكم</span>
            </a>

            <a href="{% url 'customers:list' %}" class="nav-item {% if 'customers' in request.path %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <span class="nav-text">العملاء</span>
            </a>

            <a href="{% url 'sales:list' %}" class="nav-item {% if 'sales' in request.path %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span class="nav-text">المبيعات</span>
            </a>

            <a href="{% url 'stock:dashboard' %}" class="nav-item {% if 'stock' in request.path %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                <span class="nav-text">المخزون</span>
            </a>

            {% if perms.settings.view_companysettings %}
            <a href="{% url 'employees:list' %}" class="nav-item {% if 'employees' in request.path %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span class="nav-text">الموظفين</span>
            </a>
            {% endif %}
            {% if perms.settings.view_companysettings %}
            <a href="{% url 'reports:dashboard' %}" class="nav-item {% if 'reports' in request.path %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                <span class="nav-text">التقارير</span>
            </a>
            {% endif %}
            {% if perms.settings.view_companysettings %}
            <a href="{% url 'settings:index' %}" class="nav-item {% if 'settings' in request.path %}active{% endif %}">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m8.66-13.66-4.24 4.24m-8.48 8.48-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66-4.24-4.24m-8.48-8.48L4.7 3.7"></path>
                </svg>
                <span class="nav-text">الإعدادات</span>
            </a>
            {% endif %}
        </nav>

        <!-- Logout Button -->
        <div class="sidebar-footer">
            <a href="{% url 'logout' %}" 
            class="nav-item logout-btn" 
            onclick="return confirm('هل أنت متأكد من تسجيل الخروج؟');">
             <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                 <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                 <polyline points="16 17 21 12 16 7"></polyline>
                 <line x1="21" y1="12" x2="9" y2="12"></line>
             </svg>
             <span class="nav-text">تسجيل الخروج</span>
         </a>
        </div>
    </aside>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay"></div>

    <!-- Main Content -->
    <main id="main-content" class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <!-- Mobile Menu Toggle -->
                <button id="mobile-menu-toggle" class="mobile-menu-toggle">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>

                <!-- Page Title -->
                <div class="header-title">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        {% block header_icon %}
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        {% endblock %}
                    </svg>
                    <h1>{% block page_title %}لوحة التحكم{% endblock %}</h1>
                </div>

                <!-- User Profile -->
                <div class="header-actions">
                    <!-- Notifications -->
                    <button class="notification-btn">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="notification-badge"></span>
                    </button>

                    <!-- User Profile -->
                    <div class="user-profile">
                        <img src="{% static 'images/default-avatar.png' %}" alt="User" class="user-avatar">
                        <div class="user-info">
                            <div class="user-name">{{ user.get_full_name|default:user.username }}</div>
                            <div class="user-role">مدير النظام</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <div class="page-content">
            {% if messages %}
            <div class="messages-container">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        {% if message.tags == 'success' %}
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        {% elif message.tags == 'error' %}
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                        {% else %}
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        {% endif %}
                    </svg>
                    <span>{{ message }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Base JavaScript -->
    <script src="{% static 'js/base.js' %}"></script>
    
    <!-- Page Specific JavaScript -->
    {% block extra_js %}{% endblock %}
</body>
</html>